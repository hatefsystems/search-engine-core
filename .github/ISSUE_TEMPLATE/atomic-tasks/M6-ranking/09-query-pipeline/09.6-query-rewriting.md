# ðŸŽ¯ Task 09.6: Query Rewriting & Variants Generation

## ðŸ“… Sprint Info
- **Duration:** 2 days
- **Milestone:** M6 - Ranking & Query Pipeline
- **Priority:** P1
- **Depends On:** Task 09.5 (Hybrid Spell Correction) âœ…
- **Blocks:** Task 09.4 (Multi-Stage Retrieval)
- **Assignee:** TBD

## ðŸŽ¬ What You'll Build
Generate multiple query variants (original, corrected, expanded, filtered) and orchestrate retrieval across all variants. Intelligently combine results to maximize both precision and recall.

## ðŸ“‹ Daily Breakdown

### Day 1: Query Variant Generation
- [ ] Combine outputs from stopword filtering, spell correction, expansion
- [ ] Generate 3-5 query variants with priorities
- [ ] Implement variant scoring (confidence, expected quality)
- [ ] Build retrieval orchestration across variants
- [ ] Add intelligent variant selection (don't run all if unnecessary)
- [ ] Performance optimization: parallel retrieval
- [ ] Unit tests (40+ query scenarios)

### Day 2: Integration & Testing
- [ ] Integrate with multi-stage retrieval (Task 09.4)
- [ ] Comprehensive end-to-end tests (60+ queries)
- [ ] Performance benchmarking
- [ ] Recall/precision validation
- [ ] Monitoring and metrics
- [ ] Documentation

## âœ… Acceptance Criteria
- [ ] Generates 3-5 query variants intelligently
- [ ] Recall improvement: â‰¥30% vs single-variant
- [ ] Precision maintained: <5% loss
- [ ] Latency: <100ms total (parallel retrieval)
- [ ] Adaptive: skips unnecessary variants
- [ ] Multi-language support

## ðŸ“¦ Deliverables
- `src/pipeline/QueryRewriter.h` (80 lines)
- `src/pipeline/QueryRewriter.cpp` (300 lines)
- `tests/test_query_rewriting.cpp` (60+ cases)
- `docs/query-rewriting-guide.md`

## ðŸ”— API

```cpp
struct QueryVariants {
    std::string original;
    std::string corrected;
    std::string filtered;
    std::string expanded;
    std::string filtered_expanded;
    
    std::vector<std::pair<std::string, float>> ranked_variants;
};

class QueryRewriter {
public:
    QueryVariants generate_variants(const Query& query);
    RetrievalResult retrieve_all_variants(const QueryVariants& variants);
};
```

## ðŸ“Š Success Metrics
- **Recall:** +30% improvement
- **Precision:** <5% degradation
- **Latency:** <100ms total
- **Efficiency:** Averages 2-3 variants per query

---

**Multiple angles, one perfect answer! ðŸŽ¯âœ¨**


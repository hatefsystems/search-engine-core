# ğŸ¯ Task 06.1: Weak Label Generation from Structured Data

## ğŸ“… Sprint Info
- **Duration:** 3 days
- **Milestone:** M4 - Intent & Vertical Classification
- **Priority:** P1
- **Depends On:** Task 04.2 (Structured Data Extraction) âœ…
- **Blocks:** Task 06.2 (Intent Classifier Training)
- **Assignee:** TBD

## ğŸ¬ What You'll Build
Generate weak labels for training data using structured signals (schema.org, Product/Offer pages, navigational patterns). Create labeled dataset for intent classification (Informational/Transactional/Navigational) and vertical detection (Book/Product/Article) without manual labeling.

## ğŸ“‹ Daily Breakdown

### Day 1: Transactional Signal Mining
- [ ] Extract Product/Offer pages from structured data
- [ ] Identify price/purchase patterns
- [ ] Build transactional query seeds
- [ ] Mine commercial intent signals
- [ ] Create transactional label rules
- [ ] Validate on sample pages (100+ examples)
- [ ] Document labeling heuristics

### Day 2: Navigational & Informational Patterns
- [ ] Build brand/domain matching patterns
- [ ] Identify homepage/official site queries
- [ ] Create navigational seeds
- [ ] Mine informational query patterns
- [ ] Build knowledge-seeking signals
- [ ] Validate labeling quality
- [ ] Cross-language pattern adaptation

### Day 3: Dataset Generation & Validation
- [ ] Generate labeled training set (10K+ queries)
- [ ] Add vertical labels (Book/Product/Article/Download)
- [ ] Implement quality filtering
- [ ] Create train/validation/test splits (70/15/15)
- [ ] Statistical analysis of label distribution
- [ ] Documentation and examples

## âœ… Acceptance Criteria
- [ ] Training set: 10K+ labeled queries/documents
- [ ] Label distribution balanced across intents
- [ ] Transactional precision â‰¥80% on validation
- [ ] Navigational precision â‰¥85% on validation
- [ ] Informational coverage adequate
- [ ] Works across 10+ languages automatically
- [ ] Vertical labels present for â‰¥60% of structured content

## ğŸ§ª Testing Checklist
- [ ] Manual validation of 200 labeled samples
- [ ] Cross-language label quality tests
- [ ] Intent distribution analysis
- [ ] Vertical detection validation
- [ ] Label consistency tests
- [ ] Edge case handling

## ğŸ‰ Celebration Criteria (Definition of Done)
âœ… **Demo Ready:** Show labeled dataset with quality statistics
âœ… **Metric Met:** â‰¥80% labeling precision on validation set
âœ… **Coverage:** 10K+ labeled examples across languages
âœ… **Distribution:** Balanced representation of all intents

**ğŸŠ Celebration Moment:** Training data without manual labeling!

## ğŸ“¦ Deliverables
- `src/python/weak_supervision/transactional_miner.py` (300 lines)
- `src/python/weak_supervision/navigational_miner.py` (250 lines)
- `src/python/weak_supervision/vertical_labeler.py` (200 lines)
- `src/python/weak_supervision/dataset_generator.py` (350 lines)
- `data/training/weak_labels_v1.jsonl` (labeled dataset)
- `tests/test_weak_labeling.py` (40+ test cases)
- `docs/weak-supervision-guide.md`

## ğŸ”— Dependencies & Integration

### Input
```python
# From Task 04.2: Structured Data
{
    "doc_id": str,
    "url": str,
    "title": str,
    "schema_type": str,  # "Product", "Book", "Article", None
    "has_price": bool,
    "has_offer": bool,
    "author": str,
    "publisher": str,
    "isbn": str
}
```

### Output
```python
# Weak labeled dataset
{
    "query": str,
    "doc_id": str,
    "intent_label": str,  # "informational", "transactional", "navigational"
    "intent_confidence": float,  # 0.0-1.0
    "vertical_label": str,  # "Book", "Product", "Article", "Download", "General"
    "vertical_confidence": float,
    "labeling_source": str,  # "schema.org", "price_pattern", "brand_match", etc.
    "language": str
}
```

### Labeling Heuristics
```python
# Transactional signals
- schema_type in ["Product", "Offer"]
- has_price = True
- query contains: "buy", "price", "Ø®Ø±ÛŒØ¯", "Ù‚ÛŒÙ…Øª", etc.
- URL contains: /shop/, /product/, /buy/

# Navigational signals
- Query matches brand name + generic term
- Query = exact domain name
- High brand authority (HostRank)
- Homepage queries

# Informational signals
- schema_type = "Article"
- Query contains: "how to", "what is", "Ú†Ú¯ÙˆÙ†Ù‡", "Ú†ÛŒØ³Øª"
- No commercial signals present

# Vertical detection
- Book: ISBN present, schema_type="Book", publisher/author fields
- Product: Price + offers, commercial keywords
- Article: schema_type="Article", news/blog patterns
```

## ğŸ’¡ Tips & Resources

### Common Pitfalls
- âš ï¸ **Label noise**: Weak labels aren't perfect, validate on holdout
- âš ï¸ **Imbalanced data**: Oversample rare intents (navigational)
- âš ï¸ **Language bias**: Ensure patterns work cross-linguistically
- âš ï¸ **Overfitting to heuristics**: Use diverse labeling sources

### Helpful Resources
- [Snorkel: Weak Supervision Framework](https://www.snorkel.org/)
- [Data Programming Paper](https://arxiv.org/abs/1605.07723)
- [Weak Supervision for NLP](https://github.com/snorkel-team/snorkel)

### Example Code

```python
class WeakLabelGenerator:
    def __init__(self):
        self.transactional_patterns = self.load_transactional_patterns()
        self.navigational_patterns = self.load_navigational_patterns()
        
    def label_intent(self, query: str, doc: Dict) -> Tuple[str, float]:
        """Generate weak label for query-document pair"""
        
        # Check transactional signals
        trans_score = self.score_transactional(query, doc)
        
        # Check navigational signals
        nav_score = self.score_navigational(query, doc)
        
        # Check informational (default)
        info_score = 1.0 - trans_score - nav_score
        
        # Select highest confidence label
        scores = {
            'transactional': trans_score,
            'navigational': nav_score,
            'informational': info_score
        }
        
        intent = max(scores, key=scores.get)
        confidence = scores[intent]
        
        return intent, confidence
    
    def score_transactional(self, query: str, doc: Dict) -> float:
        """Score transactional intent"""
        score = 0.0
        
        # Schema.org signals
        if doc.get('schema_type') in ['Product', 'Offer']:
            score += 0.4
        
        if doc.get('has_price'):
            score += 0.3
        
        # Query patterns
        commercial_keywords = ['buy', 'price', 'Ø®Ø±ÛŒØ¯', 'Ù‚ÛŒÙ…Øª', 'purchase']
        if any(kw in query.lower() for kw in commercial_keywords):
            score += 0.3
        
        return min(score, 1.0)
    
    def score_navigational(self, query: str, doc: Dict) -> float:
        """Score navigational intent"""
        score = 0.0
        
        # Brand matching
        if self.matches_brand(query, doc['url']):
            score += 0.6
        
        # Homepage patterns
        if doc['url'].count('/') <= 3:  # Likely homepage
            score += 0.2
        
        # High authority
        if doc.get('host_rank', 0) > 0.8:
            score += 0.2
        
        return min(score, 1.0)
    
    def label_vertical(self, doc: Dict) -> Tuple[str, float]:
        """Detect content vertical"""
        
        # Book detection
        if doc.get('isbn') or doc.get('schema_type') == 'Book':
            return 'Book', 0.9
        
        # Product detection
        if doc.get('schema_type') in ['Product', 'Offer'] and doc.get('has_price'):
            return 'Product', 0.85
        
        # Article detection
        if doc.get('schema_type') == 'Article':
            return 'Article', 0.8
        
        # Default: General
        return 'General', 0.5
```

## ğŸ“Š Success Metrics
- **Dataset Size:** 10K+ labeled examples
- **Transactional Precision:** â‰¥80%
- **Navigational Precision:** â‰¥85%
- **Vertical Detection:** â‰¥80% accuracy
- **Language Coverage:** 10+ languages
- **Label Confidence:** Average â‰¥0.7

## ğŸ“ Learning Outcomes
After completing this task, you will:
- âœ… Understand weak supervision principles
- âœ… Build training datasets without manual labeling
- âœ… Extract signals from structured data
- âœ… Design labeling heuristics for classification
- âœ… Validate weak label quality

---

**No manual labels needed! ğŸ·ï¸âœ¨**

